<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Product • LWG</title>
  <link rel="stylesheet" href="css/styles.css"/>

  <style>
    .wrap{max-width:1120px;margin:0 auto;padding:24px}
    .product{display:grid;grid-template-columns: 1fr 1fr; gap:24px}
    @media (max-width: 820px){ .product{grid-template-columns:1fr} }
    /* tidy, consistent image sizing */
    .product .imgbox{
      background:#0b1220;border:1px solid #1f2937;border-radius:14px;overflow:hidden;
      display:flex;align-items:center;justify-content:center;min-height:340px;
    }
    .product .imgbox img{width:100%;max-height:560px;object-fit:contain}
    .muted{color:var(--muted)}
    .qty{display:inline-flex;align-items:center;border:1px solid #334155;border-radius:10px;overflow:hidden}
    .qty button{border:0;background:#0b1220;color:#e5e7eb;padding:10px 14px;cursor:pointer}
    .qty input{width:72px;border:0;background:#0b1220;color:#e5e7eb;text-align:center;padding:10px}
    .related{margin-top:32px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:#0b1220;border:1px solid #1f2937;border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;height:180px;object-fit:cover;background:#111827}
    .card .body{padding:12px;display:flex;flex-direction:column;gap:8px}
    .btn{background:var(--brand);border:0;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid #334155;color:#e5e7eb}
    .price{color:var(--good);font-weight:700}
    .toast{position:fixed;right:16px;bottom:16px;background:#111827;border:1px solid #1f2937;color:#e5e7eb;padding:12px 14px;border-radius:12px;opacity:0;transform:translateY(10px);transition:.25s}
    .toast.show{opacity:1;transform:translateY(0)}
  </style>
</head>
<body>
  <!-- Top nav -->
  <nav class="nav">
    <div class="brand">
      <a href="index.html" style="display:flex;align-items:center;gap:10px">
        <span>LWG Store</span>
        <span class="badge">Shop</span>
      </a>
    </div>
    <div class="row">
      <a href="index.html" class="muted">Home</a>
      <a href="cart.html" class="btn ghost">Cart (<span id="cartCount">0</span>)</a>
      <a href="my-orders.html" class="muted">my orders</a>
      <a href="order-tracking.html" class="muted">tracking</a>
    </div>
  </nav>

  <main class="wrap">
    <div id="out"></div>
    <section class="related">
      <h3>Related products</h3>
      <div id="rel" class="grid"></div>
    </section>
  </main>

  <div class="toast" id="toast"></div>

<script>
(function(){
  // ────────────────────────────────────────────────────────────────────────────
  // Storage keys (same as Admin dashboard)
  // ────────────────────────────────────────────────────────────────────────────
  var LS_PRODUCTS = 'lwg_products';
  var LS_CART     = 'lwg_cart';

  // ────────────────────────────────────────────────────────────────────────────
  // Tiny helpers
  // ────────────────────────────────────────────────────────────────────────────
  function $(s){ return document.querySelector(s); }
  function money(n){ return 'NLe ' + Number(n||0).toLocaleString(); }
  function toast(msg){
    var t = $('#toast'); if(!t) return alert(msg);
    t.textContent = String(msg||''); t.classList.add('show');
    setTimeout(()=> t.classList.remove('show'), 1600);
  }
  function getParam(name){
    var u = new URL(location.href);
    return u.searchParams.get(name);
  }

  // ────────────────────────────────────────────────────────────────────────────
  // Store-like utilities using the SAME keys as Admin
  // ────────────────────────────────────────────────────────────────────────────
  var Store = {
    products: function(){
      try { return JSON.parse(localStorage.getItem(LS_PRODUCTS) || '[]'); }
      catch(e){ return []; }
    },
    getProduct: function(id){
      var ps = Store.products();
      for (var i=0;i<ps.length;i++){ if (ps[i].id === id) return ps[i]; }
      return null;
    },
    cart: function(){
      try { return JSON.parse(localStorage.getItem(LS_CART) || '[]'); }
      catch(e){ return []; }
    },
    saveCart: function(items){
      localStorage.setItem(LS_CART, JSON.stringify(items||[]));
    },
    addToCart: function(id, qty){
      qty = Math.max(1, Math.floor(Number(qty||1)));
      var c = Store.cart();
      var found = false;
      for (var i=0;i<c.length;i++){
        if (c[i].id === id){ c[i].qty += qty; found = true; break; }
      }
      if (!found) c.push({ id:id, qty:qty });
      Store.saveCart(c);
    }
  };

  // ────────────────────────────────────────────────────────────────────────────
  // Cart count bubble
  // ────────────────────────────────────────────────────────────────────────────
  function updateCount(){
    var c = Store.cart().reduce(function(s,i){ return s + Number(i.qty||0); }, 0);
    var el = $('#cartCount'); if (el) el.textContent = c;
  }

  // ────────────────────────────────────────────────────────────────────────────
  // Render product
  // ────────────────────────────────────────────────────────────────────────────
  function renderProduct(p){
    var out = $('#out');
    if (!p){
      out.innerHTML = '<p class="muted">Failed to load product.</p>';
      return;
    }
    out.innerHTML = `
      <section class="product">
        <div class="imgbox">
          <img src="${p.image || ''}" alt="${(p.title||'').replace(/"/g,'&quot;')}">
        </div>
        <div>
          <h1 style="margin-top:0">${p.title||''}</h1>
          <div class="row" style="justify-content:space-between">
            <div class="price" style="font-size:20px">${money(p.price||0)}</div>
            <div class="muted">Stock: ${Number(p.stock||0)}</div>
          </div>
          <p class="muted" style="white-space:pre-wrap">${p.desc||''}</p>

          <div class="row" style="gap:12px;align-items:center;margin-top:10px">
            <label class="muted">Qty</label>
            <div class="qty">
              <button type="button" id="dec">−</button>
              <input id="qty" type="number" min="1" value="1">
              <button type="button" id="inc">+</button>
            </div>
            <button class="btn" id="add">Add to cart</button>
          </div>
        </div>
      </section>
    `;

    // qty controls
    var qty = $('#qty');
    $('#dec').onclick = function(){ qty.value = Math.max(1, parseInt(qty.value||'1',10)-1); };
    $('#inc').onclick = function(){ qty.value = Math.max(1, parseInt(qty.value||'1',10)+1); };

    // add to cart
    $('#add').onclick = function(){
      var q = Math.max(1, parseInt(qty.value||'1',10));
      // If you want to respect stock, clamp here:
      if (Number.isFinite(Number(p.stock))) q = Math.min(q, Math.max(1, Number(p.stock)));
      Store.addToCart(p.id, q);
      updateCount();
      toast('Added to cart');
    };
  }

  // ────────────────────────────────────────────────────────────────────────────
  // Related products
  // ────────────────────────────────────────────────────────────────────────────
  function card(x){
    var el = document.createElement('div'); el.className='card';
    el.innerHTML = `
      <a href="product.html?id=${encodeURIComponent(x.id)}">
        <img src="${x.image||''}" alt="${(x.title||'').replace(/"/g,'&quot;')}">
      </a>
      <div class="body">
        <a href="product.html?id=${encodeURIComponent(x.id)}"><strong>${x.title||''}</strong></a>
        <div class="row" style="justify-content:space-between">
          <span class="price">${money(x.price||0)}</span>
          <span class="muted">Stock: ${Number(x.stock||0)}</span>
        </div>
        <button class="btn ghost add">Add</button>
      </div>`;
    el.querySelector('.add').onclick = function(){
      Store.addToCart(x.id, 1);
      updateCount();
      toast('Added to cart');
    };
    return el;
  }

  function renderRelated(currentId){
    var rel = $('#rel'); rel.innerHTML = '';
    var ps = Store.products().filter(function(p){ return p && p.id !== currentId; }).slice(0, 8);
    ps.forEach(function(p){ rel.appendChild(card(p)); });
  }

  // ────────────────────────────────────────────────────────────────────────────
  // Boot
  // ────────────────────────────────────────────────────────────────────────────
  var id = getParam('id');
  var product = id ? Store.getProduct(id) : null;
  renderProduct(product);
  renderRelated(id || '');
  updateCount();
})();
</script>
</body>
</html>
